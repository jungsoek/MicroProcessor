# 6. μΈν„°λ½νΈμ™€ μμ™Έ μ²λ¦¬

## 6.1 μΈν„°λ½νΈ κ°λ…κ³Ό μΆ…λ¥

### π§  μΈν„°λ½νΈλ€?

**μΈν„°λ½νΈ**λ” **ν„μ¬ μ‹¤ν–‰ μ¤‘μΈ μ‘μ—…μ„ μ¤‘λ‹¨ν•κ³ **,
 **κΈ΄κΈ‰ν•κ±°λ‚ μ°μ„ μ μΈ μ‘μ—…**μ„ CPUμ—κ² μ²λ¦¬ν•λ„λ΅ ν•λ” **λ©”μ»¤λ‹μ¦**μ΄μ•Ό.

> μ¦‰, CPUλ” ν”„λ΅κ·Έλ¨μ΄ μμ°¨μ μΌλ΅ μ‹¤ν–‰λλ” λ™μ•, νΉμ • μ΅°κ±΄μ—μ„ **μ™Έλ¶€ λλ” λ‚΄λ¶€ μ΄λ²¤νΈ**μ— μν•΄ μ‹¤ν–‰ νλ¦„μ„ λ³€κ²½ν•  μ μμ–΄.
>  μ΄λ¥Ό ν†µν•΄ λ” μ¤‘μ”ν• μ‘μ—…μ„ μ¦‰μ‹ μ²λ¦¬ν•  μ μμ–΄.

#### μ£Όμ” νΉμ§•:

1. **λΉ„λ™κΈ°μ **: μΈν„°λ½νΈλ” CPUκ°€ μκΈ°μΉ μ•κ² μ™Έλ¶€ λλ” λ‚΄λ¶€ μ‚¬κ±΄μ„ μ²λ¦¬ν•λ„λ΅ μ λ„ν•¨.
2. **μ°μ„ μμ„**: λ‹¤μμ μΈν„°λ½νΈκ°€ λ™μ‹μ— λ°μƒν•λ©΄, **μ°μ„ μμ„**μ— λ”°λΌ μ²λ¦¬λ¨.
3. **ν•Έλ“¤λ¬**: μΈν„°λ½νΈκ°€ λ°μƒν•λ©΄, ν•΄λ‹Ή μΈν„°λ½νΈλ¥Ό μ²λ¦¬ν•λ” **μΈν„°λ½νΈ μ„λΉ„μ¤ λ£¨ν‹΄(ISR)**μ΄ νΈμ¶λ¨.

### π μΈν„°λ½νΈμ λ™μ‘ κ³Όμ •

1. **μΈν„°λ½νΈ λ°μƒ**: μ™Έλ¶€ μ¥μΉ λλ” λ‚΄λ¶€ μ΄λ²¤νΈκ°€ μΈν„°λ½νΈλ¥Ό λ°μƒμ‹ν‚΄.
2. **ν„μ¬ μ‘μ—… μ¤‘λ‹¨**: CPUλ” ν„μ¬ μ‹¤ν–‰ μ¤‘μΈ λ…λ Ήμ–΄λ¥Ό μ¤‘λ‹¨ν•κ³ , μΈν„°λ½νΈ μ²λ¦¬λ¥Ό μ„ν• μ¤€λΉ„λ¥Ό μ‹μ‘.
3. **μΈν„°λ½νΈ μ„λΉ„μ¤ λ£¨ν‹΄(ISR) μ‹¤ν–‰**: CPUλ” **ISR**μ„ νΈμ¶ν•μ—¬ ν•΄λ‹Ή μΈν„°λ½νΈλ¥Ό μ²λ¦¬.
4. **λ³µκ·€**: μΈν„°λ½νΈ μ„λΉ„μ¤ λ£¨ν‹΄μ΄ μ™„λ£λλ©΄, CPUλ” **μΈν„°λ½νΈ λ°μƒ μ΄μ „**μ μ‘μ—…μΌλ΅ λμ•„κ°.

> μΈν„°λ½νΈκ°€ λ°μƒν•λ©΄ **ν„μ¬ μƒνƒ**(λ μ§€μ¤ν„° κ°’ λ“±)λ¥Ό **μ¤νƒμ— μ €μ¥**ν•κ³ , ISRμ΄ λλ‚λ©΄ μ΄ κ°’μ„ λ³µμ›ν•μ—¬ κ³„μ† μ‘μ—…μ„ μν–‰ν•¨.

### π”§ μΈν„°λ½νΈ μΆ…λ¥

μΈν„°λ½νΈλ” ν¬κ² **μ™Έλ¶€ μΈν„°λ½νΈ**μ™€ **λ‚΄λ¶€ μΈν„°λ½νΈ**λ΅ κµ¬λ¶„λλ©°, κ° μ ν•μ— λ”°λΌ μ„Έλ¶€μ μΌλ΅ λ‚λ‰μ–΄.

#### 1οΈβƒ£ **μ™Έλ¶€ μΈν„°λ½νΈ (External Interrupts)**

**μ™Έλ¶€ μΈν„°λ½νΈ**λ” μ™Έλ¶€ ν•λ“μ›¨μ–΄ μ¥μΉλ‚ μ™Έλ¶€ μ‚¬κ±΄μ— μν•΄ λ°μƒν•λ” μΈν„°λ½νΈμ•Ό.

- **I/O μ¥μΉ μΈν„°λ½νΈ**: ν‚¤λ³΄λ“, λ§μ°μ¤, λ„¤νΈμ›ν¬ μΉ΄λ“, μ„Όμ„ λ“± μ™Έλ¶€ μ¥μΉμ—μ„ λ°μƒ.
- **νƒ€μ΄λ¨Έ μΈν„°λ½νΈ**: λ‚΄μ¥ νƒ€μ΄λ¨Έκ°€ νΉμ • μ‹κ°„ ν›„ λ°μƒ.
- **μ „μ› κ΄€λ¦¬ μΈν„°λ½νΈ**: λ°°ν„°λ¦¬ λ¶€μ΅±, μ „μ› μƒνƒ λ³€ν™” λ“±μ—μ„ λ°μƒ.

#### μμ‹:

- **ν‚¤λ³΄λ“ μ…λ ¥**: ν‚¤λ³΄λ“μ—μ„ ν‚¤λ¥Ό λ„λ¥΄λ©΄, CPUλ” ν‚¤λ³΄λ“ μΈν„°λ½νΈλ¥Ό λ°›μ•„ ν•΄λ‹Ή ν‚¤κ°’μ„ μ²λ¦¬.
- **νƒ€μ΄λ¨Έ μΈν„°λ½νΈ**: μ‹μ¤ν…μ΄ μΌμ • μ£ΌκΈ°λ΅ μΈν„°λ½νΈλ¥Ό λ°μƒμ‹μΌ μ‹κ°„μ„ μΈ΅μ •ν•κ±°λ‚, μ£ΌκΈ°μ μΈ μ‘μ—…μ„ μ‹¤ν–‰.

#### 2οΈβƒ£ **λ‚΄λ¶€ μΈν„°λ½νΈ (Internal Interrupts)**

**λ‚΄λ¶€ μΈν„°λ½νΈ**λ” ν”„λ΅κ·Έλ¨ μ‹¤ν–‰ μ¤‘μ— λ°μƒν•λ” μ¤λ¥λ‚ μμ™Έμ— μν•΄ λ°μƒν•λ” μΈν„°λ½νΈμ•Ό.

- **μμ™Έ(Exceptions)**: ν”„λ΅κ·Έλ¨ μ‹¤ν–‰ μ¤‘ λ°μƒν•  μ μλ” μ¤λ¥(μ: 0μΌλ΅ λ‚λ„κΈ°, μ ‘κ·Ό λ¶κ°€ λ©”λ¨λ¦¬ μ£Όμ† λ“±)
- **νΈλ©(Traps)**: μ†ν”„νΈμ›¨μ–΄λ‚ μ΄μμ²΄μ μ—μ„ μ‚¬μ©μκ°€ μ •μν• μ΅°κ±΄μ— μν•΄ λ°μƒν•λ” μΈν„°λ½νΈ. μ£Όλ΅ λ””λ²„κΉ…, μ‹μ¤ν… νΈμ¶ λ“±μ—μ„ μ‚¬μ©.

#### μμ‹:

- **λ¶„ν•  μ¤λ¥ (Divide by Zero)**: λ‚λ„κΈ° μ—°μ‚°μ—μ„ 0μΌλ΅ λ‚λ„λ©΄, ν”„λ΅κ·Έλ¨μ— **λ‚΄λ¶€ μΈν„°λ½νΈ**κ°€ λ°μƒν•μ—¬ μ¤λ¥ μ²λ¦¬λ¥Ό ν•¨.
- **νμ΄μ§€ ν΄νΈ (Page Fault)**: ν”„λ΅κ·Έλ¨μ΄ μ ‘κ·Όν•λ ¤λ” λ©”λ¨λ¦¬ νμ΄μ§€κ°€ μ—†λ” κ²½μ°, μ΄λ¥Ό μ²λ¦¬ν•κΈ° μ„ν• **μΈν„°λ½νΈ**κ°€ λ°μƒ.

#### 3οΈβƒ£ **μ†ν”„νΈμ›¨μ–΄ μΈν„°λ½νΈ (Software Interrupts)**

**μ†ν”„νΈμ›¨μ–΄ μΈν„°λ½νΈ**λ” **ν”„λ΅κ·Έλ¨μ— μν•΄ μλ„μ μΌλ΅ λ°μƒ**ν•λ” μΈν„°λ½νΈμ•Ό. λ³΄ν†µ μ‹μ¤ν… νΈμ¶μ„ ν†µν•΄ μ΄μμ²΄μ μ™€ μƒνΈμ‘μ©ν•  λ• μ‚¬μ©λΌ.

- **μ‹μ¤ν… νΈμ¶**: μ‚¬μ©μ ν”„λ΅κ·Έλ¨μ΄ μ΄μμ²΄μ μ μ„λΉ„μ¤λ¥Ό μ”μ²­ν•  λ• μ‚¬μ©.
- **λ””λ²„κΉ… λ° νΈλ©**: ν”„λ΅κ·Έλ¨μ—μ„ νΉμ • μ΅°κ±΄μ„ ν™•μΈν•κ³ , λ””λ²„κΉ… λλ” μ¤λ¥ μ²λ¦¬λ¥Ό μ„ν•΄ μΈν„°λ½νΈλ¥Ό λ°μƒμ‹ν‚¬ μ μμ.

#### μμ‹:

- **μ‹μ¤ν… νΈμ¶**: `int 0x80` (x86 μ•„ν‚¤ν…μ²)μ™€ κ°™μ€ λ…λ Ήμ–΄λ΅, ν”„λ΅κ·Έλ¨μ΄ μ΄μμ²΄μ μ μ„λΉ„μ¤λ¥Ό μ”μ²­ν•λ” μ‹μ¤ν… μ½.
- **λ””λ²„κΉ… νΈλ©**: λ””λ²„κ±°κ°€ μ¤‘λ‹¨μ μ„ μ„¤μ •ν•μ—¬, ν”„λ΅κ·Έλ¨μ΄ νΉμ • μ§€μ μ— λ„λ‹¬ν•λ©΄ μ¤‘λ‹¨ν•κ³  λ””λ²„κΉ…μ„ μ‹μ‘ν•λ” μΈν„°λ½νΈ.

#### 4οΈβƒ£ **ν•λ“μ›¨μ–΄ μΈν„°λ½νΈ (Hardware Interrupts)**

**ν•λ“μ›¨μ–΄ μΈν„°λ½νΈ**λ” μ™Έλ¶€ μ¥μΉμ—μ„ λ°μƒν•λ” **μ‹¤μ  ν•λ“μ›¨μ–΄ μ΄λ²¤νΈ**λ΅ μΈν•΄ λ°μƒν•λ” μΈν„°λ½νΈμ•Ό.

- **CPUμ™€ λ©”λ¨λ¦¬ μ™Έλ¶€ μ¥μΉμ™€μ ν†µμ‹ **μ— ν•„μμ μ΄κ³ , CPUμ **μ‘μ—… μ¤‘λ‹¨ μ—†μ΄** μ¦‰μ‹ μ²λ¦¬κ°€ ν•„μ”ν•¨.
- **ν•λ“μ›¨μ–΄ μΈν„°λ½νΈ μ»¨νΈλ΅¤λ¬**κ°€ μΈν„°λ½νΈ μ”μ²­μ„ κ΄€λ¦¬ν•κ³  μ°μ„ μμ„λ¥Ό μ΅°μ •.

#### μμ‹:

- **νƒ€μ΄λ¨Έ μΈν„°λ½νΈ**: μ‹μ¤ν…μ μ£ΌκΈ°μ μΈ μ‘μ—…μ„ μν–‰ν•κΈ° μ„ν•΄ νƒ€μ΄λ¨Έμ—μ„ λ°μƒν•λ” μΈν„°λ½νΈ.
- **λ„¤νΈμ›ν¬ μΉ΄λ“ μΈν„°λ½νΈ**: λ„¤νΈμ›ν¬ ν¨ν‚·μ„ μμ‹ ν•λ©΄ ν•΄λ‹Ή μΈν„°λ½νΈλ¥Ό λ°μƒμ‹μΌ λ°μ΄ν„°λ¥Ό μ²λ¦¬.

### π”‘ μΈν„°λ½νΈμ™€ ν΄λ§ λΉ„κµ

| ν•­λ©          | μΈν„°λ½νΈ                  | ν΄λ§                                   |
| ------------- | ------------------------- | -------------------------------------- |
| **λ™μ‘**      | μ΄λ²¤νΈ λ°μƒ μ‹ CPUμ— μ•λ¦Ό | μ£ΌκΈ°μ μΌλ΅ μƒνƒλ¥Ό ν™•μΈ                 |
| **CPU μ‚¬μ©**  | μ΄λ²¤νΈ λ°μƒ μ‹λ§ μ‚¬μ©     | μƒνƒλ¥Ό κ³„μ† ν™•μΈν•λ―€λ΅ CPU λ¦¬μ†μ¤ μ†λ¨ |
| **μ†λ„**      | μ΄λ²¤νΈ λ°μƒ μ¦‰μ‹ μ²λ¦¬     | λ€κΈ°μ‹κ°„μ— λ”°λΌ λλ¦΄ μ μμ           |
| **μ‘λ‹µ μ‹κ°„** | μ§§μ (μ¦‰μ‹ μ²λ¦¬ κ°€λ¥)     | μƒλ€μ μΌλ΅ κΈΈμ–΄μ§                      |

### π“ μ”μ•½ μ •λ¦¬

| ν•­λ©                    | μ„¤λ…                                                         |
| ----------------------- | ------------------------------------------------------------ |
| **μΈν„°λ½νΈ**            | ν„μ¬ μ‹¤ν–‰ μ¤‘μΈ μ‘μ—…μ„ μ¤‘λ‹¨ν•κ³  μ°μ„  μ‘μ—…μ„ μ²λ¦¬ν•λ” λ©”μ»¤λ‹μ¦ |
| **μ™Έλ¶€ μΈν„°λ½νΈ**       | μ™Έλ¶€ μ¥μΉ(ν‚¤λ³΄λ“, λ§μ°μ¤, νƒ€μ΄λ¨Έ λ“±)μ—μ„ λ°μƒ                |
| **λ‚΄λ¶€ μΈν„°λ½νΈ**       | ν”„λ΅κ·Έλ¨ μ‹¤ν–‰ μ¤‘ λ°μƒν•λ” μμ™Έλ‚ μ¤λ¥                        |
| **μ†ν”„νΈμ›¨μ–΄ μΈν„°λ½νΈ** | ν”„λ΅κ·Έλ¨μ—μ„ μλ„μ μΌλ΅ λ°μƒμ‹ν‚¤λ” μΈν„°λ½νΈ                  |
| **ν•λ“μ›¨μ–΄ μΈν„°λ½νΈ**   | μ™Έλ¶€ ν•λ“μ›¨μ–΄ μ¥μΉμ—μ„ λ°μƒν•λ” μΈν„°λ½νΈ                     |
| **μ‘λ‹µ μ‹κ°„**           | μΈν„°λ½νΈλ” μ΄λ²¤νΈκ°€ λ°μƒν•  λ• μ¦‰μ‹ μ²λ¦¬, ν΄λ§μ€ μ£ΌκΈ°μ μΌλ΅ μƒνƒλ¥Ό ν™•μΈ |

## 6.2 μΈν„°λ½νΈ λ²΅ν„° ν…μ΄λΈ”

### π§  μΈν„°λ½νΈ λ²΅ν„° ν…μ΄λΈ”μ΄λ€?

**μΈν„°λ½νΈ λ²΅ν„° ν…μ΄λΈ”**μ΄λ€,
 **μΈν„°λ½νΈ λ°μƒ μ‹ ν•΄λ‹Ή μΈν„°λ½νΈμ— λ€μ‘ν•λ” μ²λ¦¬ λ£¨ν‹΄(ISR)μ μ£Όμ†λ¥Ό μ €μ¥ν• ν…μ΄λΈ”**μ΄μ•Ό.

> μ¦‰, μΈν„°λ½νΈ λ²νΈ(λλ” λ²΅ν„° λ²νΈ)κ°€ λ“¤μ–΄μ¤λ©΄,
>  CPUλ” μ΄ λ²΅ν„° λ²νΈλ¥Ό μΈλ±μ¤λ΅ μ‚Όμ•„ **IVTμ—μ„ ν•΄λ‹Ή ISR μ£Όμ†λ¥Ό μ½κ³  μ‹¤ν–‰**ν•΄.

### π“¦ κµ¬μ΅° κ°λ…

```
      μΈν„°λ½νΈ λ²΅ν„° λ²νΈ (n)
              β†“
+----------------------------+
| Interrupt Vector Table     |
+----------------------------+
| [0] β†’ Reset Handler Addr   |
| [1] β†’ NMI Handler Addr     |
| [2] β†’ HardFault Addr       |
| [3] β†’ Timer Interrupt Addr |
| [4] β†’ UART ISR Addr        |
| ...                        |
+----------------------------+
```

- κ° λ²΅ν„°λ” 4λ°”μ΄νΈ λλ” 8λ°”μ΄νΈλ΅ κµ¬μ„± (ISA λ° ν”λ«νΌμ— λ”°λΌ λ‹¤λ¦„)
- ν…μ΄λΈ”μ μ„μΉλ” λ³΄ν†µ **κ³ μ •λ λ©”λ¨λ¦¬ μ‹μ‘ μ£Όμ†**μ— μμ

### π”„ λ™μ‘ νλ¦„

1. **μΈν„°λ½νΈ λ°μƒ**
2. **CPUκ°€ μΈν„°λ½νΈ λ²΅ν„° λ²νΈ ν™•μΈ**
   - μ: νƒ€μ΄λ¨Έ μΈν„°λ½νΈ β†’ λ²΅ν„° λ²νΈ 14
3. **ν•΄λ‹Ή λ²΅ν„° λ²νΈμ ISR μ£Όμ†λ¥Ό IVTμ—μ„ μ°Έμ΅°**
4. **ν•΄λ‹Ή μ£Όμ†λ΅ λ¶„κΈ°(Jump)ν•μ—¬ ISR μ‹¤ν–‰**
5. **ISR μΆ…λ£ ν›„ λ³µκ·€ β†’ μ›λ μ‹¤ν–‰ν•λ μ½”λ“λ΅ λ³µκ·€**

### π§¬ IVTμ λ©”λ¨λ¦¬ μ„μΉ (μ‹μ¤ν…λ³„)

| μ‹μ¤ν…/ISA             | IVT μ„μΉ                                                     | λΉ„κ³                                     |
| ---------------------- | ------------------------------------------------------------ | --------------------------------------- |
| **x86 Real Mode**      | `0x0000:0000`                                                | 256κ° Γ— 4B = 1024B                      |
| **x86 Protected Mode** | IDT (Interrupt Descriptor Table) μ‚¬μ©                        | IDTλ” μΆ€ λ” ν™•μ¥λ κµ¬μ΅°                 |
| **ARM Cortex-M**       | `0x00000000` λλ” `0x20000000` (Vector Table Offset Registerμ— λ”°λΌ λ³€κ²½ κ°€λ¥) | μ²« λ²μ§Έ ν•­λ©μ€ SP, λ‘ λ²μ§Έλ¶€ν„° ISR μ£Όμ† |
| **AVR(Atmel)**         | Flash μ‹μ‘ μ£Όμ† (`0x0000`)                                   | κ° μΈν„°λ½νΈ λ²΅ν„°λ” κ³ μ •λ μ£Όμ†μ— μ„μΉ   |

### π§  ARM Cortex-M μ: λ²΅ν„° ν…μ΄λΈ” μμ‹

```
__attribute__((section(".isr_vector")))
const void* VectorTable[] = {
    &_stack_top,            // μ΄κΈ° μ¤νƒ ν¬μΈν„°
    Reset_Handler,          // Reset
    NMI_Handler,            // Non-Maskable Interrupt
    HardFault_Handler,      // HardFault
    Timer_IRQHandler,       // μ: SysTick
    UART_IRQHandler,        // μ: UART
    ...
};
```

- μ΄ ν…μ΄λΈ”μ€ λ§μ»¤ μ¤ν¬λ¦½νΈμ— λ”°λΌ Flash μ‹μ‘ μ£Όμ†μ— μ„μΉ
- `__attribute__((section))`λ¥Ό μ΄μ©ν•΄ λ²΅ν„° ν…μ΄λΈ”μ„ νΉμ • μ„μΉλ΅ λ³΄λ‚΄λ” κ² μΌλ°μ 

### π”§ IDT (Interrupt Descriptor Table) - x86 Protected Mode

x86μ—μ„λ” μ‹¤μ£Όμ†κ°€ μ•„λ‹ **λ””μ¤ν¬λ¦½ν„° κΈ°λ° λ²΅ν„° ν…μ΄λΈ”**μ„ μ‚¬μ©ν•΄.

| ν•„λ“        | μ„¤λ…                             |
| ----------- | -------------------------------- |
| Offset Low  | ISRμ ν•μ„ μ£Όμ†                  |
| Selector    | μ½”λ“ μ„Έκ·Έλ¨ΌνΈ μ„ νƒμ             |
| Type/Attr   | κ²μ΄νΈ νƒ€μ…, DPL, P(μ ν¨ ν”λκ·Έ) |
| Offset High | ISRμ μƒμ„ μ£Όμ†                  |

```
struct IDTEntry {
    uint16_t offset_low;
    uint16_t selector;
    uint8_t  zero;
    uint8_t  type_attr;
    uint16_t offset_high;
};
```

> IDTλ” `lidt` λ…λ Ήμ–΄λ΅ λ΅λ“λκ³ , λ²΅ν„° λ²νΈμ— λ”°λΌ μ ‘κ·Όλ¨.

### π§© μΈν„°λ½νΈ μ°μ„ μμ„μ™€ IVT

- λ²΅ν„° λ²νΈκ°€ μ‘μ„μλ΅ λ³΄ν†µ **μ°μ„ μμ„κ°€ λ†’λ‹¤**
   (ex: ARM Cortex-Mμ—μ„ λ²΅ν„° 1 = NMI β†’ λ§μ¤ν¬ λ¶κ°€ μΈν„°λ½νΈ)
- ν•μ§€λ§ **NVIC(ARM)** κ°™μ€ μ‹μ¤ν…μ—μ„λ” **μ°μ„ μμ„ λ μ§€μ¤ν„°λ¥Ό ν†µν•΄ μ°μ„ μμ„ μ§μ ‘ μ„¤μ • κ°€λ¥**

### π› οΈ μ‹¤μ „ μ: STM32 (Cortex-M)

```
void TIM2_IRQHandler(void) {
    if (TIM2->SR & TIM_SR_UIF) {
        TIM2->SR &= ~TIM_SR_UIF;
        // νƒ€μ΄λ¨Έ μ¤λ²„ν”λ΅μ° μ²λ¦¬
    }
}
```

> μ΄ ν•¨μμ μ΄λ¦„μ€ λ²΅ν„° ν…μ΄λΈ”μ— λ“±λ΅λμ–΄ `TIM2` μΈν„°λ½νΈκ°€ λ°μƒν•λ©΄ μλ™μΌλ΅ νΈμ¶λ¨.

### π“ μ”μ•½ μ •λ¦¬

| ν•­λ©            | μ„¤λ…                                                   |
| --------------- | ------------------------------------------------------ |
| **IVT**         | μΈν„°λ½νΈ λ²΅ν„° λ²νΈμ™€ ISR μ£Όμ†λ¥Ό λ§¤ν•‘ν•λ” ν…μ΄λΈ”        |
| **μ„μΉ**        | λ³΄ν†µ λ©”λ¨λ¦¬ μ‹μ‘ μ£Όμ†, μ‹μ¤ν…μ— λ”°λΌ λ‹¤λ¦„              |
| **μ—­ν• **        | μΈν„°λ½νΈ λ°μƒ μ‹ ISRλ΅ λ¶„κΈ°ν•κΈ° μ„ν• μ£Όμ† μ°Έμ΅°         |
| **μ‹μ¤ν… μμ‹** | x86(Real/Protected), ARM Cortex, AVR λ“±                |
| **λ³€κ²½ κ°€λ¥**   | μΌλ¶€ μ‹μ¤ν…μ€ λ°νƒ€μ„μ— λ²΅ν„° ν…μ΄λΈ” μ„μΉλ¥Ό λ°”κΏ€ μ μμ |

## 6.3 λ§μ¤ν‚Ή κ°€λ¥ν• μΈν„°λ½νΈ

### π§  κ°λ… μ”μ•½

**λ§μ¤ν‚Ή κ°€λ¥ν• μΈν„°λ½νΈ(Maskable Interrupt)**λ€,
 **CPUκ°€ λ…λ Ή λλ” μ μ–΄ λ μ§€μ¤ν„°λ¥Ό ν†µν•΄ 'λ¬΄μ‹ν•  μ μλ”(λ§μ¤ν‚Ήν•  μ μλ”)' μΈν„°λ½νΈ**λ¥Ό λ§ν•΄.

> CPUλ” μΈν„°λ½νΈλ¥Ό μ μ‹ λ„κ³  νΉμ • μ½”λ“(μ: ν¬λ¦¬ν‹°μ»¬ μ„Ήμ…)λ¥Ό **μ¤‘λ‹¨ μ—†μ΄ μ‹¤ν–‰**ν•  μ μμ–΄μ•Ό ν•¨.
>  μ΄λ• μ²λ¦¬ μ°μ„ μμ„κ°€ λ‚®μ€ μΈν„°λ½νΈλ¥Ό **λ§μ¤ν‚Ή(Disable)** ν•λ” κΈ°λ¥μ΄ ν•„μ”ν•΄.

### π§© λ§μ¤ν‚Ή vs λΉ„λ§μ¤ν‚Ή μΈν„°λ½νΈ

| κµ¬λ¶„           | λ§μ¤ν‚Ή κ°€λ¥ μΈν„°λ½νΈ                  | λΉ„λ§μ¤ν‚Ή μΈν„°λ½νΈ                          |
| -------------- | ------------------------------------- | ------------------------------------------ |
| μμ–΄λ…         | Maskable Interrupt (MI)               | Non-Maskable Interrupt (NMI)               |
| λ¬΄μ‹ κ°€λ¥ μ—¬λ¶€ | β… CPUμ—μ„ λ μ μμ                  | β CPUμ—μ„ λ μ μ—†μ                       |
| μ‚¬μ© μ©λ„      | μΌλ° I/O, Timer λ“±                    | κΈ΄κΈ‰ μ¤λ¥ μ²λ¦¬ (λ©”λ¨λ¦¬ μ¤λ¥, μ „μ› μ΄μƒ λ“±) |
| μ°μ„ μμ„       | λ‚®μ λλ” κ°€λ³€μ                       | ν•­μƒ μµκ³  μ°μ„ μμ„                         |
| λ…λ Ήμ–΄λ΅ μ μ–΄  | κ°€λ¥ (`CLI`, `SEI`, `CPSID`, `CPSIE`) | λ¶κ°€λ¥ (ν•λ“μ›¨μ–΄μ μΌλ΅ κ³ μ •λ¨)             |

### π”§ λ§μ¤ν‚Ή λ°©μ‹

#### β… 1. μ „μ—­ μΈν„°λ½νΈ ν”λκ·Έ λΉ„νΈ μ‚¬μ©

- **x86**: `IF` (Interrupt Flag)
  - `CLI` β†’ Clear Interrupt (μΈν„°λ½νΈ κΈμ§€)
  - `STI` β†’ Set Interrupt (μΈν„°λ½νΈ ν—μ©)
- **ARM Cortex-M**: `PRIMASK`, `BASEPRI`, `FAULTMASK`
  - `CPSID i` β†’ μΈν„°λ½νΈ λΉ„ν™μ„±ν™”
  - `CPSIE i` β†’ μΈν„°λ½νΈ ν™μ„±ν™”
- **AVR**: `I` λΉ„νΈ (Status Registerμ 7λ² λΉ„νΈ)
  - `sei()` β†’ μ „μ²΄ μΈν„°λ½νΈ ν™μ„±ν™”
  - `cli()` β†’ μ „μ²΄ μΈν„°λ½νΈ λΉ„ν™μ„±ν™”

#### β… 2. NVIC κΈ°λ° μ°μ„ μμ„ λ§μ¤ν‚Ή (ARM Cortex-M)

ARM Cortex-Mμ—μ„λ” **λ²΅ν„°λ³„λ΅ μ°μ„ μμ„λ¥Ό λ¶€μ—¬ν•κ³ **,
 νΉμ • μ°μ„ μμ„ μ΄ν•μ μΈν„°λ½νΈλ§ **λ§μ¤ν‚Ή κ°€λ¥**ν•κ² ν•¨.

- `BASEPRI` λ μ§€μ¤ν„°μ— νΉμ • κ°’μ„ μ„¤μ •
   β†’ ν•΄λ‹Ή κ°’λ³΄λ‹¤ μ°μ„ μμ„κ°€ **λ‚®μ€ μΈν„°λ½νΈλ” λ¬΄μ‹**,
   β†’ λ†’μ€ μΈν„°λ½νΈλ” μ—¬μ „ν ν—μ©

### π§ μ–Έμ  λ§μ¤ν‚Ήμ΄ ν•„μ”ν•κ°€?

| μƒν™©                       | μ΄μ                                           |
| -------------------------- | --------------------------------------------- |
| **ν¬λ¦¬ν‹°μ»¬ μ„Ήμ… μ‹¤ν–‰ μ¤‘**  | μ¤‘λ‹¨λλ©΄ λ°μ΄ν„° μ†μƒ λ°μƒ κ°€λ¥ (λ™κΈ°ν™” μ¤λ¥)  |
| **λ¶€νΈ λ΅λ”, μ΄κΈ°ν™” μ½”λ“** | ν•λ“μ›¨μ–΄ μ΄κΈ°ν™” λ„μ¤‘ μΈν„°λ½νΈ ν—μ©μ€ μ„ν—     |
| **μ°μ„ μμ„ μ μ–΄**          | νΉμ • μ‘μ—… μ¤‘ λ‚®μ€ μ°μ„ μμ„ μΈν„°λ½νΈ λ¬΄μ‹ ν•„μ” |
| **λ””λ²„κΉ…/νΈλ© λ³΄νΈ**       | μΈν„°λ½νΈ μ²λ¦¬ μ¤‘ λ λ‹¤λ¥Έ μΈν„°λ½νΈ μ§„μ… λ°©μ§€   |

### π’΅ μ£Όμν•  μ 

- **μΈν„°λ½νΈλ¥Ό λ„λ¬΄ μ¤λ«λ™μ• λ§μ¤ν‚Ήν•λ©΄**:
  - **λ†’μ€ μ‘λ‹µμ„±μ΄ ν•„μ”ν• μ΄λ²¤νΈ**(μ: UART μμ‹ , νƒ€μ΄λ¨Έ μ¤λ²„ν”λ΅μ° λ“±)λ¥Ό λ†“μΉ  μ μμ
  - μ‹¤μ‹κ°„μ„±μ— μν–¥ β†’ **RTOSλ‚ μ‹¤μ‹κ°„ μ μ–΄ μ‹μ¤ν…**μ—μ„λ” μ£Όμ ν•„μ”

### π§  μ‹¤μ „ μ: AVR (ATmega328P) μ½”λ“

```
cli();            // μΈν„°λ½νΈ μ „μ—­ λΉ„ν™μ„±ν™”
critical_code();  // μ¤‘μ”ν• μ‘μ—…
sei();            // λ‹¤μ‹ μΈν„°λ½νΈ ν—μ©
```

### π§  μ‹¤μ „ μ: ARM Cortex-M (STM32 λ“±)

```
__disable_irq();   // PRIMASK = 1 β†’ λ¨λ“  λ§μ¤ν¬ κ°€λ¥ν• μΈν„°λ½νΈ λΉ„ν™μ„±ν™”
critical_code();
__enable_irq();    // PRIMASK = 0 β†’ μΈν„°λ½νΈ μ¬ν™μ„±ν™”
```

λλ” `__set_BASEPRI(0x40);` κ°™μ€ ν•¨μλ΅ **μ°μ„ μμ„ κΈ°λ° λ§μ¤ν‚Ή**λ„ κ°€λ¥

### π“ μ”μ•½ μ •λ¦¬

| ν•­λ©                       | μ„¤λ…                                                   |
| -------------------------- | ------------------------------------------------------ |
| **λ§μ¤ν‚Ή κ°€λ¥ν• μΈν„°λ½νΈ** | CPUκ°€ λΉ„ν™μ„±ν™”ν•  μ μλ” μΌλ° μΈν„°λ½νΈ                 |
| **λ§μ¤ν‚Ή λ°©λ²•**            | μΈν„°λ½νΈ ν”λκ·Έ μ μ–΄ (IF, PRIMASK λ“±)                  |
| **λΉ„λ§μ¤ν‚Ή μΈν„°λ½νΈ**      | CPUμ—μ„λ„ μ λ€ λ¬΄μ‹ λ»ν•¨ (ν•λ“μ›¨μ–΄ μ¤λ¥ λ“±)            |
| **μ‚¬μ© λ©μ **              | μ¤‘μ”ν• μ½”λ“ μ¤‘λ‹¨ λ°©μ§€, μΈν„°λ½νΈ κ°„ μ°μ„ μμ„ κ΄€λ¦¬       |
| **μ‹¤μ „ μ**                | `CLI/STI`, `CPSID/CPSIE`, `__disable_irq/__enable_irq` |

## 6.4 μ†ν”„νΈμ›¨μ–΄/ν•λ“μ›¨μ–΄ μΈν„°λ½νΈ

### π§  μΈν„°λ½νΈ λ¶„λ¥ μ”μ•½

μΈν„°λ½νΈλ” **"λ„κ°€ λ°μƒμ‹ν‚¤λλƒ"**μ— λ”°λΌ μ•„λ λ‘ κ°€μ§€λ΅ λ‚λ‰μ–΄:

| μΆ…λ¥                    | λ°μƒ μ£Όμ²΄                        | νΈλ¦¬κ±° λ°©μ‹                 |
| ----------------------- | -------------------------------- | --------------------------- |
| **ν•λ“μ›¨μ–΄ μΈν„°λ½νΈ**   | μ™Έλ¶€ μ¥μΉ (I/O, νƒ€μ΄λ¨Έ, μ„Όμ„ λ“±) | **ν•λ“μ›¨μ–΄ μ‹ νΈ (ν•€ λ³€ν™”)** |
| **μ†ν”„νΈμ›¨μ–΄ μΈν„°λ½νΈ** | ν”„λ΅κ·Έλ¨ μ½”λ“                    | **λ…λ Ήμ–΄ λλ” μ‹μ¤ν… νΈμ¶** |

### π” 1. ν•λ“μ›¨μ–΄ μΈν„°λ½νΈ (Hardware Interrupt)

#### β… μ •μ

**μ™Έλ¶€ ν•λ“μ›¨μ–΄ μ¥μΉ**μ—μ„ νΉμ • μ΄λ²¤νΈκ°€ λ°μƒν•λ©΄, ν•΄λ‹Ή μ‹ νΈλ¥Ό CPUμ— μ „λ‹¬ν•μ—¬
 **ν„μ¬ μ½”λ“ μ‹¤ν–‰μ„ μ¤‘λ‹¨ν•κ³  μΈν„°λ½νΈ μ„λΉ„μ¤ λ£¨ν‹΄(ISR)μ„ νΈμ¶**ν•κ² ν•¨.

#### β… μμ‹

- **ν‚¤λ³΄λ“ μ…λ ¥**: ν‚¤λ¥Ό λ„λ¥΄λ©΄ ν‚¤λ³΄λ“ μ»¨νΈλ΅¤λ¬κ°€ μΈν„°λ½νΈ μ”μ²­ β†’ ISR μ‹¤ν–‰
- **νƒ€μ΄λ¨Έ μ¤λ²„ν”λ΅μ°**: μΌμ • μ‹κ°„λ§λ‹¤ νƒ€μ΄λ¨Έκ°€ μΈν„°λ½νΈλ¥Ό λ°μƒμ‹μΌ μ£ΌκΈ°μ  μ‘μ—… μν–‰
- **UART μμ‹ **: λ°μ΄ν„° μμ‹  μ™„λ£ β†’ RX μΈν„°λ½νΈ λ°μƒ
- **μ„Όμ„ μƒνƒ λ³€ν™”**: GPIO ν•€ λ³€ν™” κ°μ§€ μΈν„°λ½νΈ

#### β… νλ¦„ μ”μ•½

```
[ν•λ“μ›¨μ–΄ μ΄λ²¤νΈ] β†’ [μΈν„°λ½νΈ μ”μ²­ ν•€ (IRQ)] β†’ [μΈν„°λ½νΈ μ»¨νΈλ΅¤λ¬] β†’ [CPU]  
β†’ [ISR μ‹¤ν–‰] β†’ [μ›λ μ‘μ—… λ³µκ·€]
```

### π’» 2. μ†ν”„νΈμ›¨μ–΄ μΈν„°λ½νΈ (Software Interrupt)

#### β… μ •μ

**λ…λ Ήμ–΄ λλ” μ½”λ“ μƒμ—μ„ λ…μ‹μ μΌλ΅ μΈν„°λ½νΈλ¥Ό λ°μƒ**μ‹μΌ,
 μ΄μμ²΄μ λ‚ νΉμ • ν•Έλ“¤λ¬ λ£¨ν‹΄μ„ νΈμ¶ν•λ” λ°©μ‹.
 **νΉμ • μ΄λ²¤νΈ μ—†μ΄ ν”„λ΅κ·Έλλ¨Έκ°€ μλ„μ μΌλ΅ λ°μƒμ‹ν‚΄.**

#### β… μμ‹

| μƒν™©                                  | μ„¤λ…                                                         |
| ------------------------------------- | ------------------------------------------------------------ |
| **μ‹μ¤ν… νΈμ¶(System Call)**          | μ μ € μ½”λ“μ—μ„ OS μ»¤λ„μ κΈ°λ¥ μ”μ²­                            |
| β†’ `int 0x80` (x86), `svc #0` (ARM) λ“± |                                                              |
| **μμ™Έ μ²λ¦¬**                         | `div 0`, `invalid opcode` β†’ λ‚΄λ¶€μ μΌλ΅ μ†ν”„νΈμ›¨μ–΄ μΈν„°λ½νΈλ΅ μ²λ¦¬ |
| **λ””λ²„κΉ… νΈλ©**                       | `int 3` (x86) β†’ λ””λ²„κΉ… λΈλ μ΄ν¬ν¬μΈνΈ                        |
| **OS Trap**                           | μ‹μ¤ν… ν•¨μ μ§„μ… μ „μ— νΈλ© μ„¤μ • (μ: trap handler)           |

#### β… νλ¦„ μ”μ•½

```
[μ†ν”„νΈμ›¨μ–΄ λ…λ Ή] β†’ [CPU νΈλ©] β†’ [μΈν„°λ½νΈ λ²΅ν„° μ°Έμ΅°] β†’ [ISR λλ” μ»¤λ„ λ£¨ν‹΄ μ‹¤ν–‰]
```

### π”§ μ‹¤μ „ μ½”λ“ μμ‹

#### π”Ή x86 μ–΄μ…λΈ”λ¦¬μ—μ„ μ†ν”„νΈμ›¨μ–΄ μΈν„°λ½νΈ

```
mov eax, 1         ; μ‹μ¤ν… μ½ λ²νΈ (exit)
mov ebx, 0         ; λ¦¬ν„΄ μ½”λ“
int 0x80           ; μ†ν”„νΈμ›¨μ–΄ μΈν„°λ½νΈλ΅ μ»¤λ„ νΈμ¶
```

#### π”Ή ARM Cortex-Mμ—μ„ μ†ν”„νΈμ›¨μ–΄ μΈν„°λ½νΈ

```
__asm__("svc #0");   // SVC(Supervisor Call) λ…λ Ή β†’ OS κΈ°λ¥ μ”μ²­
```

### π§© μ£Όμ” μ°¨μ΄μ  λΉ„κµν‘

| ν•­λ©              | ν•λ“μ›¨μ–΄ μΈν„°λ½νΈ             | μ†ν”„νΈμ›¨μ–΄ μΈν„°λ½νΈ            |
| ----------------- | ----------------------------- | ------------------------------ |
| **λ°μƒ μ›μΈ**     | μ™Έλ¶€ μ¥μΉ (I/O, μ„Όμ„, νƒ€μ΄λ¨Έ) | μ½”λ“ λ‚΄λ¶€ λ…λ Ή λλ” μμ™Έ       |
| **λ©μ **          | μ™Έλ¶€ μ΄λ²¤νΈ κ°μ§€ λ° λ°μ‘      | μ‹μ¤ν… νΈμ¶, μμ™Έ μ²λ¦¬, λ””λ²„κΉ… |
| **μ†λ„**          | μ‹¤μ‹κ°„ (λΉ„λ™κΈ°)               | λ…λ Ήμ–΄ μ‹¤ν–‰ κΈ°λ° (λ™κΈ°)        |
| **μ μ–΄ κ°€λ¥μ„±**   | λ¶κ·μΉ™μ  (μ™Έλ¶€ μμ΅΄)          | ν”„λ΅κ·Έλλ¨Έκ°€ μ μ–΄ κ°€λ¥         |
| **μ°μ„ μμ„ μ²λ¦¬** | μΈν„°λ½νΈ μ»¨νΈλ΅¤λ¬κ°€ μ΅°μ •      | μ†ν”„νΈμ›¨μ–΄ λ…Όλ¦¬λ΅ μ΅°μ • κ°€λ¥    |
| **μμ‹ λ…λ Ήμ–΄**   | μ—†μ (ν•λ“μ›¨μ–΄ νΈλ¦¬κ±°)        | `int`, `svc`, `trap`, `brk` λ“± |

### π§  λ‘μ κ³µν†µμ 

- λ‘ λ‹¤ **μΈν„°λ½νΈ λ²΅ν„° ν…μ΄λΈ”**μ„ ν†µν•΄ ISR(μΈν„°λ½νΈ μ„λΉ„μ¤ λ£¨ν‹΄)μ„ μ‹¤ν–‰ν•¨
- λ‘ λ‹¤ **ν„μ¬ μ‘μ—… μƒνƒλ¥Ό λ³΄μ΅΄ν•κ³ ** β†’ **μΈν„°λ½νΈ μ²λ¦¬** β†’ **λ³µκ·€**ν•λ” νλ¦„μ„ κ°€μ§

### π“ μ”μ•½ μ •λ¦¬

| ν•­λ©                    | μ„¤λ…                                                         |
| ----------------------- | ------------------------------------------------------------ |
| **ν•λ“μ›¨μ–΄ μΈν„°λ½νΈ**   | μ™Έλ¶€ μ¥μΉμ μ‹ νΈλ΅ λ°μƒ, μ‹¤μ‹κ°„ μ΄λ²¤νΈ μ²λ¦¬                  |
| **μ†ν”„νΈμ›¨μ–΄ μΈν„°λ½νΈ** | λ…λ Ήμ–΄ λλ” μ½”λ“ μƒμ μ”μ²­μΌλ΅ λ°μƒ, μ‹μ¤ν… νΈμ¶ λλ” μμ™Έ μ²λ¦¬ |
| **κ³µν†µμ **              | CPUκ°€ μ‘μ—… μ¤‘λ‹¨ β†’ ISR μ§„μ… β†’ λ³µκ·€                            |
| **μ°¨μ΄μ **              | λ°μƒ μ‹μ , νΈλ¦¬κ±° λ°©μ‹, λ©μ μ μ°¨μ΄                          |

## 6.5 μμ™Έ(Exception) μ²λ¦¬ λ©”μ»¤λ‹μ¦

### π§  μμ™Έ(Exception)λ€?

**μμ™Έ(Exception)**λ” **CPUκ°€ λ…λ Ήμ–΄λ¥Ό μ‹¤ν–‰ν•λ” λ„μ¤‘**
 **μ •μƒμ μ΄μ§€ μ•μ€ μƒν™©**(μ¤λ¥, νΉμ μ”μ²­ λ“±)μ„ κ°μ§€ν–μ„ λ• λ°μƒν•λ”
 **λΉ„λ™κΈ°μ μ΄λ©΄μ„λ„ λ‚΄λ¶€μ μΈ μΈν„°λ½νΈ**λΌκ³  ν•  μ μμ–΄.

> μμ™Έλ” ν”„λ΅κ·Έλ¨ μ‹¤ν–‰ μ¤‘ λ°μƒν•λ©°, CPUκ°€ λ” μ΄μƒ μ •μƒμ μΈ λ…λ Ή μ‹¤ν–‰μ„ μ§€μ†ν•  μ μ—†λ” κ²½μ°
>  **μ¦‰μ‹ ν„μ¬ νλ¦„μ„ μ¤‘λ‹¨ν•κ³  μμ™Έ μ²λ¦¬ λ£¨ν‹΄μΌλ΅ λ¶„κΈ°**ν•κ² λΌ.

### π“ μμ™Έ vs μΈν„°λ½νΈ μ°¨μ΄μ 

| ν•­λ©          | μμ™Έ (Exception)                      | μΈν„°λ½νΈ (Interrupt)            |
| ------------- | ------------------------------------- | ------------------------------- |
| **λ°μƒ μ‹μ ** | λ…λ Ήμ–΄ μ‹¤ν–‰ μ¤‘                        | λ…λ Ήμ–΄ μ‚¬μ΄                     |
| **λ°μƒ μ›μΈ** | CPU λ‚΄λ¶€                              | μ™Έλ¶€ λλ” νƒ€μ΄λ¨Έ/IO             |
| **μμ‹**      | 0μΌλ΅ λ‚λ„κΈ°, νμ΄μ§€ ν΄νΈ, λ¶λ²• λ…λ Ή  | ν‚¤λ³΄λ“ μ…λ ¥, νƒ€μ΄λ¨Έ, UART μμ‹   |
| **μ μ–΄ μ—¬λ¶€** | μΌλ¶€λ” μ†ν”„νΈμ›¨μ–΄λ΅ λ°μƒ (μ: `trap`) | ν•λ“μ›¨μ–΄ μ΄λ²¤νΈμ— μν•΄ λ°μƒ     |
| **μΌλ° λ©μ ** | μ¤λ¥ μ²λ¦¬, OS μ”μ²­ (μ‹μ¤ν… μ½)        | λΉ„λ™κΈ° I/O μ‘λ‹µ, μ •κΈ° μ‘μ—… μ²λ¦¬ |

### π§© μμ™Έμ λ°μƒ μ΅°κ±΄

1. **μλ»λ λ…λ Ήμ–΄ μ‹¤ν–‰**
   - μ: μ΅΄μ¬ν•μ§€ μ•λ” λ…λ Ήμ–΄λ¥Ό μ‹¤ν–‰ν•λ ¤ ν•  λ•
2. **κ¶ν• μ„λ°**
   - μ‚¬μ©μ λ¨λ“μ—μ„ μ»¤λ„ μμ—­ μ ‘κ·Ό
3. **λ©”λ¨λ¦¬ μ ‘κ·Ό μ¤λ¥**
   - νμ΄μ§€ ν΄νΈ(Page Fault)
4. **μ‚°μ  μ¤λ¥**
   - 0μΌλ΅ λ‚λ„κΈ°, μ¤λ²„ν”λ΅μ°
5. **μ‹μ¤ν… νΈμ¶**
   - μ†ν”„νΈμ›¨μ–΄μ—μ„ `int`, `trap`, `svc` λ…λ ΉμΌλ΅ μ»¤λ„ μ§„μ…

### π§  μμ™Έμ μΆ…λ¥

#### β… 1. Fault (μ •μ • κ°€λ¥ν• μ¤λ¥)

- μμ™Έκ°€ λ°μƒν• **λ…λ Ήμ–΄λ” μ‹¤ν–‰λμ§€ μ•μ•κ³ **, λ³µκµ¬ ν›„ **μ¬μ‹¤ν–‰ κ°€λ¥**
- μ: νμ΄μ§€ ν΄νΈ β†’ μ΄μμ²΄μ κ°€ λ©”λ¨λ¦¬ νμ΄μ§€λ¥Ό μ¬λ¦° ν›„ λ…λ Ή μ¬μ‹λ„

#### β… 2. Trap (μ •μƒμ  μΆ…λ£ ν›„ μ•λ¦Ό)

- λ…λ Ήμ–΄λ” **μ •μƒμ μΌλ΅ μ‹¤ν–‰λ ν›„**, μμ™Έκ°€ λ°μƒ
- μ: λ””λ²„κ±°μ λΈλ μ΄ν¬ν¬μΈνΈ, μ‹μ¤ν… μ½

#### β… 3. Abort (μΉλ…μ  μ¤λ¥)

- **νλ³µ λ¶κ°€λ¥ν• μ¤λ¥**
- μ: λ²„μ¤ μ¤λ¥(Bus Fault), λ…λ Ήμ–΄ fetch μ‹¤ν¨ λ“±

### π”§ μμ™Έ μ²λ¦¬ νλ¦„

1. μμ™Έ λ°μƒ (ex. divide by zero, trap)
2. CPUλ” ν„μ¬ λ…λ Ήμ–΄ μ‹¤ν–‰μ„ μ¤‘λ‹¨
3. **μ¤νƒμ— ν„μ¬ μƒνƒ(PC, PSR, λ μ§€μ¤ν„° λ“±) μ €μ¥**
4. μμ™Έ λ²΅ν„° ν…μ΄λΈ”μ—μ„ ν•΄λ‹Ή μμ™Έμ ν•Έλ“¤λ¬ μ£Όμ† μ°Έμ΅°
5. ν•΄λ‹Ή **μμ™Έ ν•Έλ“¤λ¬(Handler/ISR) μ‹¤ν–‰**
6. μμ™Έ μ²λ¦¬ μ™„λ£ ν›„, `IRET` λλ” `ERET` λ“±μ„ ν†µν•΄ λ³µκ·€

### π“‚ μ‹μ¤ν…λ³„ μμ™Έ μ²λ¦¬ λ°©μ‹

#### π”Ή x86 (IA-32)

- **IDT(Interrupt Descriptor Table)** μ‚¬μ©
- μμ™Έλ§λ‹¤ κ³ μ  λ²΅ν„° λ²νΈ (0~31)
- μ:
  - `#DE`(Divide Error) β†’ λ²΅ν„° 0
  - `#PF`(Page Fault) β†’ λ²΅ν„° 14
  - `#GP`(General Protection) β†’ λ²΅ν„° 13

> μμ™Έ λ°μƒ μ‹ CPUλ” IDTμ—μ„ ν•΄λ‹Ή λ²΅ν„°λ¥Ό μ°Ύκ³ , κ·Έ μ„μΉμ ν•Έλ“¤λ¬λ΅ μ ν”„

#### π”Ή ARM Cortex-M

- λ²΅ν„° ν…μ΄λΈ” κµ¬μ΅°λ΅ μμ™Έ κ΄€λ¦¬
- μ°μ„ μμ„: Reset > NMI > HardFault > MemManage > BusFault > UsageFault β€¦

| μμ™Έ           | μ„¤λ…                     |
| -------------- | ------------------------ |
| **Reset**      | μ „μ› μΈκ°€ μ‹ μ§„μ…        |
| **NMI**        | λ§μ¤ν‚Ή λ¶κ°€λ¥ν• μΈν„°λ½νΈ |
| **HardFault**  | μΉλ…μ μΈ μ¤λ¥            |
| **MemManage**  | λ©”λ¨λ¦¬ μ ‘κ·Ό μ¤λ¥         |
| **BusFault**   | λ²„μ¤ ν†µμ‹  μ¤‘ μ¤λ¥        |
| **UsageFault** | μλ»λ λ…λ Ήμ–΄ μ‚¬μ© λ“±    |

> μ: `SCB->SHCSR`λ΅ μμ™Έ ν™μ„±ν™”/λΉ„ν™μ„±ν™” μ„¤μ • κ°€λ¥

### π› οΈ μ‹μ¤ν… νΈμ¶ = μ†ν”„νΈμ›¨μ–΄ μμ™Έμ ν• ν•νƒ

- μ‚¬μ©μκ°€ `int 0x80`(x86), `svc #0`(ARM) λ…λ Ή μ‹¤ν–‰
- μ»¤λ„ λ¨λ“λ΅ μ§„μ…ν•μ—¬ **μ‹μ¤ν… μ½ μ²λ¦¬ λ£¨ν‹΄ μ‹¤ν–‰**
- trap handlerλ” μ»¤λ„ μ§„μ…μ  μ—­ν•  μν–‰

### π§ μ‹¤μ „ μ: x86μ—μ„ μμ™Έ ν•Έλ“¤λ¬ μ

```
section .text
global divide_by_zero
divide_by_zero:
    ; μ¤λ¥ μ²λ¦¬ μ½”λ“
    iret    ; λ³µκ·€
```

β†’ IDTμ λ²΅ν„° 0λ²μ΄ μ΄ ν•¨μ μ£Όμ†λ¥Ό κ°€λ¦¬ν‚¤λ„λ΅ μ„¤μ •

### π“ μ”μ•½ μ •λ¦¬

| ν•­λ©                | μ„¤λ…                                                   |
| ------------------- | ------------------------------------------------------ |
| **μμ™Έ(Exception)** | λ…λ Ή μ‹¤ν–‰ μ¤‘ λ°μƒν•λ” μ¤λ¥ λλ” μ΄λ²¤νΈ                 |
| **μΆ…λ¥**            | Fault (μ¬μ‹¤ν–‰), Trap (μΆ…λ£ ν›„ μ²λ¦¬), Abort (λ³µκµ¬ λ¶κ°€) |
| **μ²λ¦¬ νλ¦„**       | μƒνƒ μ €μ¥ β†’ λ²΅ν„° ν…μ΄λΈ” μ°Έμ΅° β†’ ν•Έλ“¤λ¬ μ‹¤ν–‰ β†’ λ³µκ·€      |
| **μ‹μ¤ν… μ**       | x86: IDT κΈ°λ°, ARM: λ²΅ν„° ν…μ΄λΈ” κΈ°λ°                   |
| **ν™μ© μ**         | νμ΄μ§€ ν΄νΈ, μ‹μ¤ν… μ½, λ””λ²„κΉ…, μ ‘κ·Ό μ„λ° λ“±           |

## 6.6 μΈν„°λ½νΈ μ°μ„ μμ„ μ²λ¦¬

> Interrupt Priority and Nesting

### π§  μ™ μ°μ„ μμ„κ°€ ν•„μ”ν•κ°€?

μ‹μ¤ν…μ—μ„λ” μ—¬λ¬ μΈν„°λ½νΈκ°€ **λ™μ‹μ—** λ°μƒν•  μ μκΈ° λ•λ¬Έμ—
 **λ„κµ¬λ¥Ό λ¨Όμ € μ²λ¦¬ν• μ§€ νλ‹¨ν•λ” κΈ°μ¤€**μ΄ ν•„μ”ν•΄.
 μλ¥Ό λ“¤μ–΄:

> UART μμ‹  vs μ„Όμ„ λ°μ΄ν„° vs κΈ΄κΈ‰ μ‹μ¤ν… νƒ€μ΄λ¨Έ
>  β†’ λ¨λ‘ λ™μ‹μ— λ°μƒν–μ„ λ•, **νƒ€μ΄λ¨Έμ²λΌ μ¤‘μ”ν• μ‘μ—…μ„ λ¨Όμ € μ²λ¦¬**ν•΄μ•Ό ν•¨

### π”Ί μ°μ„ μμ„ μ²λ¦¬μ λ©μ 

| λ©μ                    | μ„¤λ…                                             |
| ---------------------- | ------------------------------------------------ |
| **μ‹¤μ‹κ°„μ„± λ³΄μ¥**      | μ¤‘μ”ν• μ‘μ—…μ΄ μ¦‰μ‹ μ²λ¦¬λ  μ μλ„λ΅ ν•¨           |
| **μ‹μ¤ν… μ•μ •μ„±**      | μ €μ°μ„  μΈν„°λ½νΈκ°€ κ³ μ°μ„  μ²λ¦¬λ¥Ό λ°©ν•΄ν•μ§€ μ•κ² ν•¨ |
| **μ¤‘μ²© μΈν„°λ½νΈ μ§€μ›** | κ³ μ°μ„  μΈν„°λ½νΈλ” μ €μ°μ„  ISR μ¤‘μ—λ„ μ²λ¦¬ κ°€λ¥    |

### π”© κΈ°λ³Έ λ™μ‘ μ›λ¦¬

1. μ—¬λ¬ μΈν„°λ½νΈκ°€ λ™μ‹μ— λ°μƒ
2. **μΈν„°λ½νΈ μ»¨νΈλ΅¤λ¬**κ°€ μ°μ„ μμ„λ¥Ό ν‰κ°€
3. κ°€μ¥ λ†’μ€ μ°μ„ μμ„μ ISRλ¶€ν„° μ‹¤ν–‰
4. μ‹¤ν–‰ μ¤‘ λ” λ†’μ€ μ°μ„ μμ„ μΈν„°λ½νΈκ°€ λ°μƒν•λ©΄:
   - ν„μ¬ ISR μƒνƒ μ €μ¥ β†’ κ³ μ°μ„  ISR μ‹¤ν–‰ β†’ λ³µκ·€ ν›„ μ¬κ°

> μ΄κ±Έ **μ¤‘μ²© μΈν„°λ½νΈ(Nested Interrupt)** λΌκ³  ν•΄

### π§± μ°μ„ μμ„ μ²λ¦¬ λ°©μ‹ μΆ…λ¥

#### β… 1. κ³ μ • μ°μ„ μμ„ (Fixed Priority)

- κ° μΈν„°λ½νΈ μ†μ¤μ— κ³ μ •λ μ°μ„ μμ„λ¥Ό λ¶€μ—¬
- μΌλ°μ μΈ μ‘μ€ MCUμ—μ„ μ‚¬μ© (μ: AVR)

#### β… 2. ν”„λ΅κ·Έλλ¨ΈλΈ” μ°μ„ μμ„ (Programmable Priority)

- μ†ν”„νΈμ›¨μ–΄λ΅ μ°μ„ μμ„ μ„¤μ • κ°€λ¥
- ARM Cortex-Mμ NVIC (Nested Vectored Interrupt Controller) κµ¬μ΅°κ°€ λ€ν‘μ 

#### β… 3. λ™μ  μ°μ„ μμ„ (Dynamic Priority)

- μƒν™©μ— λ”°λΌ μ°μ„ μμ„λ¥Ό μ‹¤μ‹κ°„μΌλ΅ μ΅°μ •
- RTOS κΈ°λ° μ‹μ¤ν…μ΄λ‚ κ³ κΈ‰ SoCμ—μ„ μ‚¬μ©

### π§© μ‹μ¤ν…λ³„ μ°μ„ μμ„ κµ¬μ΅°

#### π”Ή AVR (μ: ATmega328P)

- μ°μ„ μμ„ μ—†μ β†’ **μ„μΉ κΈ°μ¤€ μ²λ¦¬**
- λ‚®μ€ λ²΅ν„° λ²νΈκ°€ μ°μ„ μμ„ λ†’μ
- μ¤‘μ²© μΈν„°λ½νΈλ” κΈ°λ³Έμ μΌλ΅ λ¶κ°€ (`sei()`λ΅ λ…μ‹μ  ν—μ©ν•΄μ•Ό ν•¨)

#### π”Ή ARM Cortex-M (μ: STM32)

- **NVIC** κµ¬μ΅° κΈ°λ°
- κ° μΈν„°λ½νΈμ— **0~255 λ‹¨κ³„μ μ°μ„ μμ„** λ¶€μ—¬ κ°€λ¥
- μ°μ„ μμ„λ” **Preemption Priority (μ„ μ )** + **Sub Priority (κ°™μ€ λ λ²¨ λ‚΄ μμ„)**λ΅ κµ¬μ„±

```
HAL_NVIC_SetPriority(USART1_IRQn, 1, 0); // USART1 μΈν„°λ½νΈ μ°μ„ μμ„ μ„¤μ •
HAL_NVIC_EnableIRQ(USART1_IRQn);
```

- μ«μκ°€ **μ‘μ„μλ΅ μ°μ„ μμ„κ°€ λ†’μ** (`0` > `1` > `2`...)

#### π”Ή x86 κµ¬μ΅° (8259 PIC, APIC λ“±)

- κΈ°λ³Έμ μΌλ΅ **PIC** λλ” **APIC**μ—μ„ μ°μ„ μμ„ μ²λ¦¬
- x86μ€ μΈν„°λ½νΈ μ°μ„ μμ„λ¥Ό **λ²΅ν„° λ²νΈ**μ— λ”°λΌ κ²°μ •
- μ΄μμ²΄μ κ°€ **IDT(Index Descriptor Table)** λ¥Ό ν†µν•΄ μ°μ„ μμ„ μ¬κµ¬μ„± κ°€λ¥

### π§  μ¤‘μ²© μΈν„°λ½νΈ(Nested Interrupt)

> ν„μ¬ ISRμ΄ μ‹¤ν–‰ μ¤‘μΌ λ•, λ” λ†’μ€ μ°μ„ μμ„ μΈν„°λ½νΈκ°€ λ°μƒν•λ©΄
>  **ν„μ¬ ISRμ μƒνƒλ¥Ό μ¤νƒμ— μ €μ¥ν•κ³ **, κ³ μ°μ„  ISRμ„ λ¨Όμ € μ²λ¦¬ν• ν›„
>  λ‹¤μ‹ λμ•„μ™€ μ›λ ISRμ„ κ³„μ† μ‹¤ν–‰ν•λ” κµ¬μ΅°

#### ν•„μ” μ΅°κ±΄:

| μ΅°κ±΄                              | μ„¤λ…                                                         |
| --------------------------------- | ------------------------------------------------------------ |
| **μΈν„°λ½νΈ μ¤‘ μΈν„°λ½νΈ ν—μ©**     | ISR λ‚΄λ¶€μ—μ„ μΈν„°λ½νΈ μ „μ—­ ν—μ© (`sei()`, `__enable_irq()` λ“±) |
| **μ»¨νΈλ΅¤λ¬κ°€ μ°μ„ μμ„ λΉ„κµ κ°€λ¥** | NVIC, APIC λ“±                                                |
| **μ¤νƒ μ—¬μ  μ¶©λ¶„**                | ISR μ¤‘ ISRμ„ μ‹¤ν–‰ν•λ ¤λ©΄ μƒνƒ λ³΄μ΅΄ ν•„μ”ν•¨                     |

### π§ μ‹¤μ „ μμ  (ARM Cortex-M)

```
void USART1_IRQHandler(void) {
    HAL_NVIC_SetPriority(TIM2_IRQn, 0, 0);  // TIM2κ°€ λ” λ†’μ€ μ°μ„ μμ„
    HAL_NVIC_SetPriority(USART1_IRQn, 1, 0);
}
```

β†’ `USART1_IRQHandler()` μ‹¤ν–‰ μ¤‘μ΄λΌλ„ `TIM2_IRQHandler()`λ” μ„ μ  κ°€λ¥

### π“ μ°μ„ μμ„ μ²λ¦¬ νλ¦„ μμ‹

```
[UART μμ‹  μΈν„°λ½νΈ] β†’ μ°μ„ μμ„ 2
[νƒ€μ΄λ¨Έ μΈν„°λ½νΈ]   β†’ μ°μ„ μμ„ 1 (λ” λ†’μ)

β†’ νƒ€μ΄λ¨Έ ISR μ‹¤ν–‰ μ¤‘ UART μΈν„°λ½νΈ λ°μƒ β†’ λ¬΄μ‹λ¨
β†’ UART ISR μ‹¤ν–‰ μ¤‘ νƒ€μ΄λ¨Έ μΈν„°λ½νΈ λ°μƒ β†’ μ¤‘μ²© μ‹¤ν–‰ κ°€λ¥
```

### π“ μ”μ•½ μ •λ¦¬

| ν•­λ©                      | μ„¤λ…                                                |
| ------------------------- | --------------------------------------------------- |
| **μ°μ„ μμ„ ν•„μ”μ„±**       | λ™μ‹μ— λ°μƒν•λ” μΈν„°λ½νΈλ¥Ό μ •λ ¬, μ¤‘μ”ν• κ²ƒλ¶€ν„° μ²λ¦¬ |
| **κ³ μ • μ°μ„ μμ„**         | λ²΅ν„° μ„μΉλ΅ κ²°μ • (AVR λ“±)                           |
| **ν”„λ΅κ·Έλλ¨ΈλΈ” μ°μ„ μμ„** | NVIC, APIC κΈ°λ° μ‹μ¤ν… (ARM, x86)                   |
| **μ°μ„ μμ„ μ„¤μ •λ²•**       | ARM: `NVIC_SetPriority()`, x86: IDT κΈ°λ°            |
| **μ¤‘μ²© μΈν„°λ½νΈ**         | ISR μ‹¤ν–‰ μ¤‘ λ” λ†’μ€ μΈν„°λ½νΈκ°€ λ°μƒν•λ©΄ μ‹¤ν–‰ κ°€λ¥   |